<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ¡ã‚¤ãƒ³ã‚³ãƒ”ãƒ¼ç”Ÿæˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .api-key-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .api-key-section.open {
            max-height: 500px;
        }
    </style>
</head>
<body class="bg-gray-100 py-8 sm:py-12">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-10">
            
            <header class="text-center mb-6">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">AIãƒ¡ã‚¤ãƒ³ã‚³ãƒ”ãƒ¼ç”Ÿæˆ</h1>
                <p class="text-gray-500">ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã®URLã‹ã‚‰ã€AIãŒé­…åŠ›çš„ãªãƒ¡ã‚¤ãƒ³ã‚³ãƒ”ãƒ¼ã¨è¦ç´„ã‚’ææ¡ˆã—ã¾ã™ã€‚</p>
            </header>

            <!-- APIã‚­ãƒ¼è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div id="apiKeySection" class="api-key-section mb-6">
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                    <h3 class="text-lg font-bold text-yellow-800">APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„</h3>
                    <p class="text-yellow-700 text-sm mt-1">
                        ã“ã®ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Google AIã®ç„¡æ–™APIã‚­ãƒ¼ãŒå¿…è¦ã§ã™ã€‚
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" class="font-bold underline hover:text-yellow-800">ã“ã¡ã‚‰ã®ãƒªãƒ³ã‚¯</a>
                        ã‹ã‚‰ã‚­ãƒ¼ã‚’å–å¾—ã—ã€ä»¥ä¸‹ã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚
                    </p>
                    <div class="flex flex-col sm:flex-row gap-2 mt-4">
                        <input type="password" id="apiKeyInput" placeholder="APIã‚­ãƒ¼ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘" class="flex-grow w-full px-4 py-2 bg-white border-2 border-yellow-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        <button id="saveApiKeyButton" class="w-full sm:w-auto bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-6 rounded-lg transition-colors">ä¿å­˜</button>
                    </div>
                </div>
            </div>

            <main id="mainContent" class="hidden">
                <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
                <div class="space-y-4 mb-6">
                    <div>
                        <label for="urlInput" class="block text-sm font-medium text-gray-700 mb-1">ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆURL</label>
                        <input type="url" id="urlInput" placeholder="https://example.com" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="additionalRequestInput" class="block text-sm font-medium text-gray-700 mb-1">è¿½åŠ ã®è¦æœ› (ä»»æ„)</label>
                        <textarea id="additionalRequestInput" rows="2" placeholder="ä¾‹: è‹¥è€…å‘ã‘ã€é¢ç™½ã„æ„Ÿã˜ã§ã€SEOã‚’æ„è­˜ã—ã¦" class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                </div>
                <div class="text-center">
                    <button id="generateButton" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:shadow-lg transition-all transform hover:-translate-y-0.5">ææ¡ˆã‚’ç”Ÿæˆ</button>
                </div>

                <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="resultContainer" class="mt-8">
                    <div id="loader" class="hidden flex flex-col items-center justify-center text-center p-8">
                        <div class="loader mb-4"></div>
                        <p class="text-gray-600 font-semibold">AIãŒãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚“ã§åˆ†æä¸­ã§ã™...</p>
                    </div>
                    <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert">
                        <strong class="font-bold">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</strong>
                        <span class="block sm:inline" id="errorText"></span>
                    </div>
                    <div id="manualInputContainer" class="hidden mt-6 p-6 bg-gray-50 rounded-lg border border-dashed">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">URLã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</h3>
                        <p class="text-gray-600 mb-4">ãŠæ‰‹æ•°ã§ã™ãŒã€ã‚µã‚¤ãƒˆã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä»¥ä¸‹ã«ç›´æ¥è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</p>
                        <textarea id="manualTextInput" rows="10" class="w-full px-4 py-3 bg-white border-2 border-gray-200 rounded-lg" placeholder="ã“ã“ã«ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®æœ¬æ–‡ã‚’è²¼ã‚Šä»˜ã‘..."></textarea>
                        <button id="generateFromTextButton" class="mt-4 w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg">ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ç”Ÿæˆ</button>
                    </div>

                    <div id="copyResult" class="hidden mt-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 lg:gap-8">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 pb-2">ææ¡ˆã•ã‚ŒãŸãƒ¡ã‚¤ãƒ³ã‚³ãƒ”ãƒ¼</h2>
                                <div id="copyList" class="grid grid-cols-1 gap-4"></div>
                            </div>
                            <div id="summarySection" class="mt-8 lg:mt-0">
                                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 pb-2">ãƒšãƒ¼ã‚¸ã®è¦ç´„</h2>
                                <div id="summaryContent" class="text-gray-700 bg-slate-50 p-5 rounded-lg border border-gray-200 space-y-4"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        <footer class="text-center mt-6 text-gray-500 text-sm">
            <p>&copy; 2024 ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</p>
        </footer>
    </div>

    <script>
        const apiKeySection = document.getElementById('apiKeySection');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const saveApiKeyButton = document.getElementById('saveApiKeyButton');
        const mainContent = document.getElementById('mainContent');
        const urlInput = document.getElementById('urlInput');
        const additionalRequestInput = document.getElementById('additionalRequestInput');
        const generateButton = document.getElementById('generateButton');
        const loader = document.getElementById('loader');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const copyResult = document.getElementById('copyResult');
        const copyList = document.getElementById('copyList');
        const summarySection = document.getElementById('summarySection');
        const summaryContent = document.getElementById('summaryContent');
        const manualInputContainer = document.getElementById('manualInputContainer');
        const manualTextInput = document.getElementById('manualTextInput');
        const generateFromTextButton = document.getElementById('generateFromTextButton');

        document.addEventListener('DOMContentLoaded', () => {
            checkApiKey();
            saveApiKeyButton.addEventListener('click', saveApiKey);
            generateButton.addEventListener('click', handleGeneration);
            generateFromTextButton.addEventListener('click', handleGenerationFromText);
        });

        function checkApiKey() {
            if (localStorage.getItem('geminiApiKey')) {
                apiKeySection.classList.remove('open');
                mainContent.classList.remove('hidden');
            } else {
                apiKeySection.classList.add('open');
                mainContent.classList.add('hidden');
            }
        }

        function saveApiKey() {
            const apiKey = apiKeyInput.value.trim();
            if (apiKey) {
                localStorage.setItem('geminiApiKey', apiKey);
                apiKeyInput.value = '';
                checkApiKey();
            } else {
                alert('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            }
        }

        // ã€æ”¹å–„ç‚¹ã€‘AIã¸ã®æŒ‡ç¤ºã‚’ã€ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ†ã‘ã—ãŸè¦ç´„ã‚’å«ã‚€ã‚ˆã†ã«å¤‰æ›´
        async function callGeminiAPI(textContent, additionalRequest) {
            const apiKey = localStorage.getItem('geminiApiKey');
            if (!apiKey) throw new Error('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            let prompt = `ä»¥ä¸‹ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åˆ†æã—ã€çµæœã‚’JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚
JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ä»¥ä¸‹ã®2ã¤ã®ã‚­ãƒ¼ã‚’æŒã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
1. "copies": ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èˆˆå‘³ã‚’å¼•ãé­…åŠ›çš„ãªãƒ¡ã‚¤ãƒ³ã‚³ãƒ”ãƒ¼ã‚’æ—¥æœ¬èªã§10å€‹æ ¼ç´ã—ãŸæ–‡å­—åˆ—ã®é…åˆ—ã€‚
2. "summary": ä»¥ä¸‹ã®3ã¤ã®ã‚­ãƒ¼ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚
   - "target": "æƒ³å®šã•ã‚Œã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¡§å®¢"ã‚’è¨˜è¿°ã—ãŸæ–‡ç« ã€‚
   - "features": "å•†æãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®ä¸»ãªç‰¹å¾´"ã‚’ç®‡æ¡æ›¸ãã§è¨˜è¿°ã—ãŸæ–‡ç« ã€‚
   - "strengths": "ä»–ã«ã¯ãªã„å¼·ã¿ã‚„ãƒã‚¤ãƒ³ãƒˆ"ã‚’è¨˜è¿°ã—ãŸæ–‡ç« ã€‚

ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’å³å®ˆã—ã¦ãã ã•ã„:
- "copies"ã®é…åˆ—å†…ã®å„ã‚³ãƒ”ãƒ¼ã¯ã€ç®‡æ¡æ›¸ãã®è¨˜å·ã‚„ã€Œã€ã‚’å«ã¾ãªã„ã€ç´”ç²‹ãªãƒ†ã‚­ã‚¹ãƒˆã§ã‚ã‚‹ã“ã¨ã€‚
- "summary"å†…ã®å„æ–‡ç« ã¯ã€ã§ã™ãƒ»ã¾ã™èª¿ã§ã€æ”¹è¡Œã‚’å«ã‚ã¦èª­ã¿ã‚„ã™ãè¨˜è¿°ã™ã‚‹ã“ã¨ã€‚
- JSONå½¢å¼ä»¥å¤–ã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆä¾‹: \`\`\`json ... \`\`\` ã‚„å‰ç½®ãï¼‰ã¯ä¸€åˆ‡å«ã‚ãªã„ã§ãã ã•ã„ã€‚`;

            if (additionalRequest) {
                prompt += `\n\nã€è¿½åŠ ã®è¦æœ›ã€‘\n${additionalRequest}\nã“ã®è¦æœ›ã¯ã€ä¸»ã«"copies"ã®ç”Ÿæˆã«åæ˜ ã•ã›ã¦ãã ã•ã„ã€‚`;
            }
            prompt += `\n\n---\n[ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„]\n${textContent}\n---\n\nJSONå‡ºåŠ›:`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: { responseMimeType: "application/json" }
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                 if(response.status === 400) throw new Error('APIã‚­ãƒ¼ãŒæ­£ã—ããªã„ã‹ã€ç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
                 throw new Error('AIã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }

            const result = await response.json();
            
            if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                return result.candidates[0].content.parts[0].text;
            } else {
                throw new Error('AIãŒæœ‰åŠ¹ãªææ¡ˆã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
            }
        }
        
        async function handleGeneration() {
            const url = urlInput.value.trim();
            if (!url) { showError('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }
            resetUI(); setLoadingState(true);
            try {
                const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(url)}`;
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error(`ãƒšãƒ¼ã‚¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ (ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status})`);
                const htmlContent = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, 'text/html');
                const bodyText = doc.body.innerText || "";
                if (bodyText.trim().length < 20) throw new Error('ãƒšãƒ¼ã‚¸ã‹ã‚‰ååˆ†ãªãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
                await generateCopy(bodyText);
            } catch (error) {
                console.error('URLã‹ã‚‰ã®ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                const userMessage = 'ãƒšãƒ¼ã‚¸ã®è‡ªå‹•å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚µã‚¤ãƒˆãŒå¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‹ã€URLãŒæ­£ã—ããªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚';
                showError(userMessage);
                manualInputContainer.classList.remove('hidden');
            } finally {
                setLoadingState(false);
            }
        }

        async function handleGenerationFromText() {
            const textContent = manualTextInput.value.trim();
            if (!textContent) { showError('ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚'); return; }
            resetUI(); setLoadingState(true);
            await generateCopy(textContent);
            setLoadingState(false);
        }

        async function generateCopy(textContent) {
             try {
                const truncatedText = textContent.substring(0, 8000);
                const additionalRequest = additionalRequestInput.value.trim();
                const generatedJsonText = await callGeminiAPI(truncatedText, additionalRequest);
                displayResults(generatedJsonText);
             } catch(apiError) {
                console.error('APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:', apiError);
                showError(apiError.message || 'AIã‹ã‚‰ã®å¿œç­”ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
             }
        }

        // ã€æ”¹å–„ç‚¹ã€‘ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ†ã‘ã•ã‚ŒãŸè¦ç´„ã‚’è¡¨ç¤ºã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯
        function displayResults(jsonString) {
            try {
                const result = JSON.parse(jsonString);
                const copies = result.copies;
                const summary = result.summary;

                // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ”ãƒ¼ã‚’è¡¨ç¤º
                copyList.innerHTML = '';
                if (copies && Array.isArray(copies)) {
                    copies.forEach(copyText => {
                        const cleanText = copyText.trim();
                        if (cleanText) {
                            const card = document.createElement('div');
                            card.className = 'bg-slate-50 p-4 rounded-lg border border-gray-200 flex flex-col sm:flex-row justify-between sm:items-center gap-4 transition-shadow hover:shadow-md';
                            card.innerHTML = `<p class="text-gray-800 flex-grow text-lg">${cleanText}</p><button class="copy-button flex-shrink-0 w-full sm:w-auto bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg flex items-center justify-center gap-2"><span>ã‚³ãƒ”ãƒ¼</span></button>`;
                            card.querySelector('.copy-button').addEventListener('click', (e) => copyToClipboard(cleanText, e.currentTarget));
                            copyList.appendChild(card);
                        }
                    });
                }
                
                // è¦ç´„ã‚’è¡¨ç¤º
                summaryContent.innerHTML = ''; // ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¯ãƒªã‚¢
                if (summary) {
                    const summaryCategories = [
                        { key: 'target', title: 'ğŸ¯ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ' },
                        { key: 'features', title: 'âœ¨ ä¸»ãªç‰¹å¾´' },
                        { key: 'strengths', title: 'ğŸ’ª å¼·ã¿ãƒ»ãƒã‚¤ãƒ³ãƒˆ' }
                    ];

                    let summaryHtml = '';
                    summaryCategories.forEach(category => {
                        if (summary[category.key]) {
                            summaryHtml += `<div class="mb-4">
                                <h3 class="text-lg font-bold text-gray-900">${category.title}</h3>
                                <p class="text-gray-600 mt-1">${summary[category.key].replace(/\n/g, '<br>')}</p>
                            </div>`;
                        }
                    });
                    summaryContent.innerHTML = summaryHtml;
                    summarySection.classList.remove('hidden');
                } else {
                    summarySection.classList.add('hidden');
                }

                copyResult.classList.remove('hidden');

            } catch (e) {
                console.error("JSONã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ:", e);
                showError('AIã‹ã‚‰ã®å¿œç­”å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            }
        }
        
        function setLoadingState(isLoading) {
            generateButton.disabled = isLoading;
            generateButton.textContent = isLoading ? 'ç”Ÿæˆä¸­...' : 'ææ¡ˆã‚’ç”Ÿæˆ';
            loader.classList.toggle('hidden', !isLoading);
        }

        function resetUI() {
            errorMessage.classList.add('hidden');
            copyResult.classList.add('hidden');
            manualInputContainer.classList.add('hidden'); 
            copyList.innerHTML = '';
            summaryContent.innerHTML = '';
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
        }
        
        function copyToClipboard(text, buttonElement) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = buttonElement.innerHTML;
                buttonElement.innerHTML = `<span>ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</span>`;
                buttonElement.classList.replace('bg-gray-200', 'bg-green-500');
                buttonElement.classList.add('text-white');
                setTimeout(() => {
                    buttonElement.innerHTML = originalText;
                    buttonElement.classList.replace('bg-green-500', 'bg-gray-200');
                    buttonElement.classList.remove('text-white');
                }, 2000);
            }).catch(err => console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—:', err));
        }
    </script>
</body>
</html>
